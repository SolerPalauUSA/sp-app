<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta name="theme-color" content="#053658"/>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="./assets/css/styles.css">
     <link rel="stylesheet" href="./globleStyles.css">
    <title>Soler Palau USA | App</title>
     <style>
        body {
            background-color: whitesmoke;
            overflow: hidden; /* This prevents scrolling */
        }
    </style>

      
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sp-app/service-worker.js', {
            scope: '/sp-app/'
        })
        .then((registration) => {
            // When the user navigates to your site,
            // the browser tries to redownload the script file that defined the service worker
            // in the background.
            // If there is even a byte's difference in the service worker file compared to what it currently has,
            // it considers it 'new'.
            let serviceWorker;
            if (registration.installing) {
                serviceWorker = registration.installing;
                console.log('Service worker installing');
            } else if (registration.waiting) {
                serviceWorker = registration.waiting;
                console.log('Service worker installed & waiting');
            } else if (registration.active) {
                serviceWorker = registration.active;
                console.log('Service worker active');
            }

            if (serviceWorker) {
                serviceWorker.addEventListener('statechange', (e) => {
                    console.log('Service worker state change:', e.target.state);
                    if (e.target.state === 'activated') {
                        // Check if this is the first service worker to control the page or not
                        if (!navigator.serviceWorker.controller) {
                            console.log('Service worker activated for the first time!');
                        } else {
                            // New service worker has taken over, show notification
                            console.log('New content is available; please refresh.');
                            document.getElementById('update-notification').style.display = 'block';
                        }
                    }
                });
            }
        })
        .catch((error) => {
            console.error('Service Worker registration failed:', error);
        });

        let refreshing;
        // The event listener that is fired when the service worker updates
        // Here we reload the page
        navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (refreshing) return;
            window.location.reload();
            refreshing = true;
        });
    });
}


  </script>



</head>
<body>

   <div style="color: whitesmoke; background-color: #053658 ; width: 100%; position: fixed; top: 0; display: flex; justify-content: space-between; opacity: 1 ;">
        <div style="
            text-transform: uppercase;
            letter-spacing: 2px;
            align-content: center;
            display: flex;
            flex-wrap: wrap;
            font-weight: 500;
            
        "></div>
       <div style="padding: .5rem; display: block; margin-left: auto; margin-right: auto;">Soler Palau USA</div>
    </div>


   <main>



        
        <!-- Grid of icons and links -->

        <div class="grid-container">
            <div style="font-size: 30px;
            align-self: center;
            display: flex; margin-bottom: 5px;
            color: #053658;
            font-weight: 600;
            ">WELCOME ! </div>
            <div style="font-size: 35px;
            margin-top: 5px;
            display: flex;
            align-self: center; margin-bottom: 50px;
            color: #053658;
            font-weight: 600;
            ">Explore S&P Rep Hub</div>
        <div class="icon-grid">
            <div class="icon">
                <a href="./pages/products.html">
                    <img src="assets/images/fan-solid.svg" alt="Products" class="icon-color">
                    <div>Products</div>
                </a>
            </div>
            <div class="icon">
                <a href="./pages/library.html">
                    <img src="assets/images/file-pdf-solid.svg" alt="Documents" class="icon-color">
                    <div>Documents</div>
                </a>
            </div>
            <div class="icon">
                <a href="./pages/cross-ref.html">
                    <img src="assets/images/right-left-solid.svg" alt="Cross References" class="icon-color">
                    <div>Cross References</div>
                </a>
            </div>
           <div class="icon">
                <a href="./pages/important-links.html">
                    <img src="assets/images/links.svg" alt="links" class="icon-color">
                    <div>Important Links</div>
                </a>
            </div>
        </div>

    </div>

    <div id="ios-install-instructions" style="display: none;">
        <div style="
            background-color: rgba(0, 0, 0, 0.5); 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 999; 
            display: flex; 
            justify-content: center; 
            align-items: center;">
            <div id="ios-model-container" class="ios-model">
                <button id="close-ios-instructions">X</button>
                <p>To install this application on your mobile device.</p>
                <p>Tap the <img src="assets/images/Share-outline-01.svg" alt="Share Icon" style="vertical-align: middle; height: 24px; margin: 0 4px;"> icon below, and then tap on "Add to home screen".</p>
            </div>
        </div>
    </div>
 </main>

      <!-- Android Install Button -->
        <button id="install-button-android">Install App</button>

        <!-- Update Notification Modal -->
<div id="update-notification" style="display: none; position: fixed; bottom: 10px; right: 10px; background: white; padding: 20px; box-shadow: 0 0 5px rgba(0,0,0,0.2); z-index: 1000;">
    New content is available. 
    <button onclick="document.location.reload(true)">Refresh</button>
    <button onclick="document.getElementById('update-notification').style.display='none'">Close</button>
</div>


<script type="module" src="firebase.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    let deferredPrompt;
    const installButtonAndroid = document.getElementById('install-button-android');
    const iosInstallInstructions = document.getElementById('ios-install-instructions');
    const closeIosInstructions = document.getElementById('close-ios-instructions');
    const closeChromeInstructions = document.getElementById('close-chrome-instructions');

    // Function to check if the app has been installed
    function isAppInstalled() {
      return localStorage.getItem('appInstalled') === 'true';
    }

    // Function to check if the browser is Chrome on iOS
    const isIosChrome = () => {
        const userAgent = window.navigator.userAgent.toLowerCase();
        return /crios/.test(userAgent) && isIos();
    };

    // Check if the device is on iOS
    const isIos = () => {
      const userAgent = window.navigator.userAgent.toLowerCase();
      return /iphone|ipad|ipod/.test(userAgent);
    };

    // Check if the user has closed the instructions
    const iosInstructionsClosed = localStorage.getItem('iosInstructionsClosed');

    // Check if the user is anonymous (modify this condition based on your Firebase authentication logic)
    const isUserAnonymous = true; // You need to implement the user check logic here

    function hideIosInstallInstructions() {
  iosInstallInstructions.style.display = 'none';
  localStorage.setItem('iosInstructionsClosed', 'true');
}

closeIosInstructions.addEventListener('click', hideIosInstallInstructions);


    if (isIos() && (!isAppInstalled() || isUserAnonymous) && !iosInstructionsClosed) {
  installButtonAndroid.style.display = 'none';
  iosInstallInstructions.style.display = 'flex';

  // Check if the browser is Chrome on iOS
  if (isIosChrome()) {
    const iosModelContainer = document.getElementById('ios-model-container');
    iosModelContainer.classList.add('chrome-style');
    iosModelContainer.style.alignSelf = 'start';

    // Apply additional styles for Chrome on iOS
    iosModelContainer.style.borderRadius = '0px';
    iosModelContainer.style.marginLeft = '.25rem';
    iosModelContainer.style.marginRight = '.25rem';
    iosModelContainer.style.marginTop = '2rem';

    // Update the modal content for Chrome on iOS
    iosModelContainer.innerHTML = `
        <button id="close-chrome-instructions">X</button>
        <p>To install this application on your mobile device.</p>
        <p>Tap the <img src="assets/images/Share-outline-01.svg" alt="Share Icon" style="vertical-align: middle; height: 24px; margin: 0 4px;"> icon above, and then tap on "Add to home screen".</p>
    `;

    // Add event listener for Chrome-style close button
    const closeChromeInstructions = document.getElementById('close-chrome-instructions');
    closeChromeInstructions.addEventListener('click', hideIosInstallInstructions);

  } else if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {
    const iosModelContainer = document.getElementById('ios-model-container');
    iosModelContainer.classList.add('safari-style');
    iosModelContainer.style.alignSelf = 'end';
  }

      // Check if the app is running in standalone mode
      if (window.matchMedia('(display-mode: standalone)').matches) {
        iosInstallInstructions.style.display = 'none'; // Hide iOS instructions
        installButtonAndroid.style.display = 'none'; // Hide Android button
      }
    }

    window.addEventListener('beforeinstallprompt', (event) => {
      // Check if the app is not installed
      if (!isAppInstalled()) {
        event.preventDefault();
        deferredPrompt = event;
        installButtonAndroid.removeAttribute('hidden');
      }
    });

    installButtonAndroid.addEventListener('click', async () => {
      if (!deferredPrompt) {
        return;
      }

      const result = await deferredPrompt.prompt();
      console.log(`Install prompt result: ${result.outcome}`);

      if (result.outcome === 'accepted') {
        console.log('User accepted the install prompt');

       
      // Set the flag to indicate that the app has been installed
      localStorage.setItem('appInstalled', 'true');

// Hide the install button
installButtonAndroid.style.display = 'none';
} else {
console.log('User dismissed the install prompt');
}

deferredPrompt = null;
});
});
 </script>



</body>
</html>
